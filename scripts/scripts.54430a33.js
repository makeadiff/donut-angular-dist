"use strict";angular.module("donutApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngMaterial","ngStorage"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",restricted:!0,title:"Home"}).when("/add-donation",{templateUrl:"views/add-donation.html",controller:"AddDonationCtrl",restricted:!0,title:"Add Donation"}).when("/view-donation",{templateUrl:"views/view-donation.html",controller:"ViewDonationCtrl",restricted:!0,title:"View Donation"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",restricted:!1,title:"Login"}).when("/logout",{templateUrl:"views/logout.html",controller:"LogoutCtrl",restricted:!1}).when("/select-event",{templateUrl:"views/select-event.html",controller:"SelectEventCtrl",restricted:!0}).when("/external-donation",{templateUrl:"views/external-donation.html",controller:"ExternalDonationCtrl",restricted:!0,title:"External Donations"}).when("/add-external-donation/:donation_type",{templateUrl:"views/add-external-donation.html",controller:"AddExternalDonationCtrl",restricted:!0,title:"Add External Donations"}).when("/approvals",{templateUrl:"views/approvals.html",restricted:!0,title:"Approve Donations"}).when("/change-password",{templateUrl:"views/change-password.html",controller:"ChangePasswordCtrl",restricted:!0,title:"Change Password"}).otherwise({redirectTo:"/"})}]).run(["$location","$rootScope",function(a,b){b.base_url="http://localhost/makeadiff.in/home/makeadiff/public_html/apps/exdon/api/",b.$on("$routeChangeSuccess",function(a,c){b.title=c.$$route&&c.$$route.title?c.$$route.title:"Donut"})}]),angular.module("donutApp").controller("HomeCtrl",["UserService","$location",function(a,b){var c=this;a.checkLoggedIn()||b.path("/login"),c.is_poc=a.isPOC()}]),angular.module("donutApp").controller("AddDonationCtrl",["$http","$mdDialog","UserService","$location","$filter","$rootScope",function(a,b,c,d,e,f){var g=this;g.donation={},g.donation.name="",g.donation.amount="",g.donation.email="",g.donation.phone="",g.donation.address="",g.donation.comment="",g.donation.eighty_g="false",g.phone_email_absent=!1,g.phone_invalid=!1,g.amount_invalid=!1,g.is_processing=!1;c.getUserId();g.validCheck=function(){return 0==g.donationForm.$valid?!1:parseInt(g.donation.amount)>200&&""==g.donation.phone&&""==g.donation.email?(g.phone_email_absent=!0,!1):0!=g.donation.phone.length&&isNaN(g.donation.phone)?(g.phone_invalid=!0,!1):0!=g.donation.amount.length&&isNaN(g.donation.amount)?(g.amount_invalid=!0,g.phone_email_absent=!1,g.phone_invalid=!1,!1):(g.amount_invalid=!1,g.phone_invalid=!1,g.phone_email_absent=!1,!0)},g.addDonation=function(){if(g.is_processing=!0,c.checkLoggedIn()){var h=c.getUserId();a({method:"POST",url:f.base_url+"donation/add",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},data:{amount:g.donation.amount,donor_name:g.donation.name,donor_email:g.donation.email,donor_phone:g.donation.phone,eighty_g_required:g.donation.eighty_g,address:g.donation.address,comment:g.donation.comment,fundraiser_id:h,created_at:e("date")(g.donation.created_at,"yyyy-MM-dd"),format:"json"}}).success(function(a){g.is_processing=!1;var c=b.alert().title("Success!").content("Donation successfully added. ID: "+a.donation.id).ok("Ok");b.show(c)}).error(function(){g.is_processing=!1,g.is_error=!0;var a=b.alert().title("Error!").content("Connection issue with '"+f.base_url+"donation/add'. Please try again later.").ok("Ok");b.show(a)})}else{g.is_processing=!1;var i=b.alert().title("Error!").content("Connection error. Please try again later.").ok("Ok");b.show(i),d.path("/login")}g.donation={},g.donation.name="",g.donation.amount="",g.donation.email="",g.donation.phone="",g.donation.address="",g.donation.comment="",g.donation.eighty_g="false",g.donationForm.$setUntouched(),g.donationForm.$setPristine()}}]),angular.module("donutApp").controller("ViewDonationCtrl",["$http","$mdDialog","UserService","$location",function(a,b,c,d){var e=this;if(e.is_processing=!0,e.donations={},c.checkLoggedIn()){var f=c.getUserId();a({method:"POST",url:"http://cfrapp.makeadiff.in:3000/mobile_reports/vol_report.json",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded","Access-Control-Allow-Origin":"Origin, X-Requested-With, Content-Type, Accept",Authorization:"Basic "+window.btoa("mad:mad")},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},data:{id:f}}).success(function(a){e.donations=a,e.is_processing=!1}).error(function(){e.is_processing=!1;var a=b.alert().title("Error!").content("Connection error. Please try again later.").ok("Ok");b.show(a),d.path("/")})}else{e.is_processing=!1;var g=b.alert().title("Error!").content("Connection error. Please try again later.").ok("Ok");b.show(g),d.path("/login")}}]),angular.module("donutApp").factory("UserService",["$localStorage",function(a){var b={};return b.setLoggedIn=function(b){a.user_id=b.id,a.user=b,a.loggedIn=!0},b.checkLoggedIn=function(){return a.loggedIn},b.getUserId=function(){return a.user_id},b.isPOC=function(){for(var b in a.user.roles)if(9==b)return!0;return!1},b.unsetLoggedIn=function(){return a.user_id=0,a.user={},a.loggedIn=!1,!0},b}]),angular.module("donutApp").directive("checkUser",["$rootScope","$location","UserService",function(a,b,c){return{link:function(){a.$on("$routeChangeStart",function(a,d){d.restricted&&!c.checkLoggedIn()&&b.path("/login")})}}}]),angular.module("donutApp").controller("LoginCtrl",["$http","$scope","$rootScope","$mdToast","UserService","$location",function(a,b,c,d,e,f){var g=this;g.login={},g.login_invalid=!1,g.error_message="",g.is_processing=!1,g.loginCheck=function(){g.is_processing=!0,a({method:"POST",url:c.base_url+"user/login",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},data:{phone:g.login.phone,password:g.login.password,format:"xml"}}).success(function(a){a.error?(g.is_processing=!1,e.unsetLoggedIn(),g.login_invalid=!0,g.error_message=a.error,g.login={}):(g.is_processing=!1,e.setLoggedIn(a.user),f.path("/"))}).error(function(){e.unsetLoggedIn()})}}]),angular.module("donutApp").controller("LogoutCtrl",["$location","UserService",function(a,b){b.unsetLoggedIn(),a.path("/login")}]),angular.module("donutApp").controller("ApprovalsCtrl",["$http","$scope","$rootScope","$mdDialog","UserService","$location",function(a,b,c,d,e,f){var g=this;if(g.is_processing=!0,g.error="",g.donations={},e.checkLoggedIn()){var h=e.getUserId();a({method:"GET",url:c.base_url+"donation/get_donations_for_approval/"+h,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}}).success(function(a){g.is_processing=!1,a.success?g.donations=a.donations:g.error=a.error}).error(function(){g.is_processing=!1;var a=d.alert().title("Error!").content("Connection error. Please try again later.").ok("Ok");d.show(a),f.path("/")})}else{g.is_processing=!1;var i=d.alert().title("Error!").content("Connection error. Please login again.").ok("Ok");d.show(i),f.path("/login")}g.approveDonation=function(b){if(g.is_processing=!0,!e.checkLoggedIn()){g.is_processing=!1;var h=d.alert().title("Error!").content("Connection error. Please try again later.").ok("Ok");return d.show(h),void f.path("/login")}var i=e.getUserId();a({method:"GET",url:c.base_url+"donation/"+b+"/approve/"+i,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}}).success(function(a){g.is_processing=!1,g.donations[903].donation_status="APPROVED";var b=d.alert().title("Success!").content("Donation Approved. ID: "+a.donation_id).ok("Ok");d.show(b)}).error(function(){g.is_processing=!1;var a=d.alert().title("Error!").content("Connection error. Please try again later.").ok("Ok");d.show(a)})}}]).filter("dateToISO",function(){return function(a){var b=a.split(/[- :]/),c=new Date(b[0],b[1]-1,b[2],b[3],b[4],b[5]);return c.toISOString()}}),angular.module("donutApp").controller("ChangePasswordCtrl",["$http","$mdDialog","UserService","$location",function(a,b,c,d){var e=this;e.password="",e.password_confirmation="",e.password_not_match=!1,e.password_length_less=!1,e.is_processing=!1,e.validCheck=function(){return""==e.password||""==e.password_confirmation?!1:""!=e.password&&""!=e.password_confirmation&&e.password==e.password_confirmation&&e.password.length<4?(e.password_not_match=!1,e.password_length_less=!0,!1):""!=e.password&&""!=e.password_confirmation&&e.password!=e.password_confirmation?(e.password_not_match=!0,e.password_length_less=!1,!1):(e.password_not_match=!1,e.password_length_less=!1,!0)},e.changePassword=function(){if(e.is_processing=!0,c.checkLoggedIn()){var f=c.getUserId();a({method:"PATCH",url:"http://cfrapp.makeadiff.in:3000/mobileauth/"+f,withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded","Access-Control-Allow-Origin":"Origin, X-Requested-With, Content-Type, Accept",Authorization:"Basic "+window.btoa("mad:mad")},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},transformResponse:function(a){var b=new X2JS,c=b.xml_str2json(a);return c},data:{password:e.password_confirmation}}).success(function(){e.is_processing=!1;var a=b.alert().title("Success!").content("Password succesfully changed").ok("Ok");b.show(a),d.path("/")}).error(function(){e.is_processing=!1;var a=b.alert().title("Error!").content("Connection error. Please try again later.").ok("Ok");b.show(a)})}else{e.is_processing=!1;var g=b.alert().title("Error!").content("Connection error. Please try again later.").ok("Ok");b.show(g),d.path("/login")}e.password="",e.password_confirmation=""}}]),angular.module("donutApp").controller("ExternalDonationCtrl",["$location",function(){}]),angular.module("donutApp").controller("AddExternalDonationCtrl",["$http","$mdDialog","UserService","$location","$routeParams","$filter","$rootScope",function(a,b,c,d,e,f,g){var h=this;h.donation={},h.donation.name="",h.donation.amount="",h.donation.email="",h.donation.phone="",h.donation.donation_type=e.donation_type,h.donation.created_at=new Date,h.is_error=!1,h.phone_absent=!1,h.email_absent=!1,h.phone_invalid=!1,h.email_invalid=!1,h.amount_invalid=!1,h.is_processing=!1,h.fundraiser_id=c.getUserId(),h.validCheck=function(){return 0==h.donationForm.$valid?!1:""==h.donation.phone?(h.phone_absent=!0,!1):""==h.donation.email?(h.email_absent=!0,!1):10!=h.donation.phone.length||isNaN(h.donation.phone)?(h.phone_invalid=!0,!1):h.donation.email.match(/^[\w\-\+\.]+\@[\w\-\.]+\.[\w]{2,5}$/)?0!=h.donation.amount.length&&isNaN(h.donation.amount)?(h.amount_invalid=!0,!1):(h.phone_absent=!1,h.email_absent=!1,h.phone_invalid=!1,h.email_invalid=!1,h.amount_invalid=!1,!0):(h.email_invalid=!0,!1)},h.addExDonation=function(){if(h.is_processing=!0,c.checkLoggedIn()){var e=c.getUserId();a({method:"POST",url:g.base_url+"donation/add",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},data:{amount:h.donation.amount,donor_name:h.donation.name,donor_email:h.donation.email,donor_phone:h.donation.phone,fundraiser_id:e,created_at:f("date")(h.donation.created_at,"yyyy-MM-dd"),donation_type:h.donation.donation_type,format:"json"}}).success(function(a){h.is_processing=!1;var c=b.alert().title("Success!").content("Donation successfully added. ID: "+a.donation.id).ok("Ok");b.show(c)}).error(function(){h.is_processing=!1,h.is_error=!0;var a=b.alert().title("Error!").content("Connection issue with '"+add_donation_url+"'. Please try again later.").ok("Ok");b.show(a)})}else{h.is_processing=!1,h.is_error=!0;var i=b.alert().title("Error!").content("Connection error. Please try again later.").ok("Ok");b.show(i),d.path("/login")}h.donation={},h.donation.name="",h.donation.amount="",h.donation.email="",h.donation.phone="",h.donation.donation_type="",h.donation.created_at=""}}]);